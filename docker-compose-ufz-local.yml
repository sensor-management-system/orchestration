# Web client of the Sensor Management System software developed within
# the Helmholtz DataHub Initiative by GFZ and UFZ.
#
# Copyright (C) 2020
# - Martin Abbrent (UFZ, martin.abbrent@ufz.de)
# - Tobias Kuhnert (UFZ, tobias.kuhnert@ufz.de)
# - Helmholtz Centre for Environmental Research GmbH - UFZ
#   (UFZ, https://www.ufz.de)
#
# Parts of this program were developed within the context of the
# following publicly funded projects or measures:
# - Helmholtz Earth and Environment DataHub
#   (https://www.helmholtz.de/en/research/earth_and_environment/initiatives/#h51095)
#
# Licensed under the HEESIL, Version 1.0 or - as soon they will be
# approved by the "Community" - subsequent versions of the HEESIL
# (the "Licence").
#
# You may not use this work except in compliance with the Licence.
#
# You may obtain a copy of the Licence at:
# https://gitext.gfz-potsdam.de/software/heesil
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the Licence is distributed on an "AS IS" basis,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
# implied. See the Licence for the specific language governing
# permissions and limitations under the Licence.
version: '3.7'
services:

  node:
    build:
      context: '.'
      dockerfile: 'docker/local-dev/Dockerfile-local-dev'
    user: "node"
    working_dir: /home/node/
    ports:
      - 3000:3000
    environment:
      BASE_URL: "/"
      INSTITUTE: "ufz"
      SMS_BACKEND_HOST_URL: "http://localhost:5000/rdm/svm-api/v1"
      CV_BACKEND_URL: "http://localhost:8000/api/v1"
      NUXT_ENV_REDIRECT_URI: "https://localhost.localdomain:3000/login-callback"
      NUXT_ENV_CLIENT_ID: "rdmsvm-implicit-flow"
      NUXT_ENV_AUTHORITY: "https://webapp.ufz.de/idp/oidc/v1"
      NUXT_ENV_RESPONSE_TYPE: "id_token"
      NUXT_ENV_SCOPE: "openid profile email"
      NUXT_ENV_POST_LOGOUT_REDIRECT_URI: "https://localhost.localdomain:3000/logout-callback"
      NUXT_ENV_SILENT_REDIRECT_URI: "https://localhost.localdomain:3000/silent-callback"
      NUXT_ENV_FILTER_PROTOCOL_CLAIMS: 'false'
      NUXT_ENV_AUTOMATIC_SILENT_RENEW: 'false'
      NUXT_ENV_SILENT_RENEW_INTERVAL: 6900000 # 115 minutes in milliseconds
      NUXT_ENV_LOAD_USER_INFO: 'true'
      NUXT_ENV_PUBLIC_PATH: ''
    volumes:
      - .:/home/node/
    command: >
      bash -c "npm install
      && npm run dev"
