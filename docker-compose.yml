version: '3.7'
services:

  node:
    image: node:current-slim
    user: "node"
    working_dir: /home/node/
    ports:
      - "127.0.0.1:${HTTP_PORT:-3000}:3000"
    environment:
#      BASE_URL: "/rdm/svm"
      BASE_URL: "/"
      NUXT_ENV_REDIRECT_URI: "https://localhost.localdomain:3000/login-callback"
      NUXT_ENV_CLIENT_ID: "rdmsvm-implicit-flow"
      NUXT_ENV_AUTHORITY: "https://webapp.ufz.de/idp/oidc/v1"
      NUXT_ENV_RESPONSE_TYPE: "id_token"
      NUXT_ENV_SCOPE: "openid profile email"
      NUXT_ENV_POST_LOGOUT_REDIRECT_URI: "https://localhost.localdomain:3000/logout-callback"
      NUXT_ENV_SILENT_REDIRECT_URI: "https://localhost.localdomain:3000/silent-callback"
      NUXT_ENV_FILTER_PROTOCOL_CLAIMS: 'false'
      NUXT_ENV_AUTOMATIC_SILENT_RENEW: 'true'
      NUXT_ENV_SILENT_RENEW_INTERVAL:  6900000 # 115 minutes in milliseconds
    volumes:
      - .:/home/node/
    command: >
      bash -c "npm install
      && npm run dev -- -H 0.0.0.0"
